function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"9zR4":function(e,t,i){"use strict";i.r(t),i.d(t,"DetectionsModule",(function(){return T}));var a=i("ofXK"),n=i("tyNb"),s=i("Mn71"),l=i("fXoL"),o=i("xsI5"),c=i("OaWH"),r=i("HFyB");function b(e,t){if(1&e&&(l.Ub(0,"div",7),l.Qb(1,"img",8),l.Tb()),2&e){var i=l.kc();l.Ab(1),l.rc("src",i.appService.assets("/images/ajax-loader.gif"),l.Fc)}}function d(e,t){1&e&&(l.Ub(0,"div",9),l.Mc(1,"No DATA"),l.Tb())}function u(e,t){if(1&e&&(l.Ub(0,"span"),l.Mc(1),l.Tb()),2&e){var i=l.kc().$implicit;l.Ab(1),l.Oc("+",i.behaviors_processed.length,"")}}function p(e,t){if(1&e&&(l.Ub(0,"tr"),l.Ub(1,"td"),l.Ub(2,"div",10),l.Ub(3,"div",11),l.Qb(4,"i",12),l.Tb(),l.Ub(5,"div",13),l.Mc(6),l.Qb(7,"br"),l.Kc(8,u,2,1,"span",14),l.Tb(),l.Tb(),l.Tb(),l.Ub(9,"td"),l.Ub(10,"div",15),l.Mc(11,"Tactic & technique"),l.Tb(),l.Ub(12,"div",16),l.Mc(13),l.Tb(),l.Tb(),l.Ub(14,"td"),l.Ub(15,"div",15),l.Mc(16,"Detect time"),l.Tb(),l.Ub(17,"div",17),l.Mc(18),l.lc(19,"date"),l.Tb(),l.Tb(),l.Ub(20,"td"),l.Ub(21,"div",15),l.Mc(22,"Host"),l.Tb(),l.Ub(23,"div",17),l.Mc(24),l.Tb(),l.Tb(),l.Ub(25,"td"),l.Ub(26,"div",15),l.Mc(27,"User name"),l.Tb(),l.Ub(28,"div",17),l.Mc(29),l.Tb(),l.Tb(),l.Ub(30,"td"),l.Ub(31,"div",15),l.Mc(32,"Assigned to"),l.Tb(),l.Ub(33,"div",17),l.Mc(34,"-"),l.Tb(),l.Tb(),l.Ub(35,"td"),l.Ub(36,"div",15),l.Mc(37,"Status"),l.Tb(),l.Ub(38,"div",17),l.Mc(39),l.Tb(),l.Tb(),l.Tb()),2&e){var i=t.$implicit,a=l.kc();l.Ab(6),l.Oc("",i.max_severity_displayname," "),l.Ab(2),l.rc("ngIf",i.behaviors_processed.length>=2),l.Ab(4),l.sc("title",i.behaviors[0].tactic+" via "+i.behaviors[0].technique),l.Ab(1),l.Oc(" ",i.behaviors[0].tactic+" via "+i.behaviors[0].technique," "),l.Ab(5),l.Nc(l.nc(19,8,i.behaviors[0].timestamp,"dd MMM yyyy hh:mm a")),l.Ab(6),l.Nc(i.device.hostname),l.Ab(5),l.Nc(i.behaviors[0].user_name),l.Ab(10),l.Nc(a.formatString(i.status))}}var f,v,h,m=[{path:"",component:(f=function(){function e(t,i,a){var n=this;_classCallCheck(this,e),this._css=t,this.appService=i,this.router=a,this.detectionsFiltered=[],this.filterCol=[{title:"Severity",fields:[{label:"Critical",selected:!1,prop:"(max_severity:>=80+max_severity:<101)",count:0},{label:"High",selected:!1,prop:"(max_severity:>=60+max_severity:<80)",count:0},{label:"Medium",selected:!1,prop:"(max_severity:>=40+max_severity:<60)",count:0},{label:"Low",selected:!1,prop:"(max_severity:>=20+max_severity:<40)",count:0},{label:"Informational",selected:!1,prop:"(max_severity:>=0+max_severity:<20)",count:0}],prop:"behavior.severity"},{title:"Tactic",fields:[],prop:"behaviors.tactic"},{title:"Technique",fields:[],prop:"behaviors.technique"},{title:"Time",fields:[{label:"Last hour",selected:!1,prop:"last_behavior:>='now-1h'"},{label:"Last day",selected:!1,prop:"last_behavior:>='now-1d'"},{label:"Last week",selected:!1,prop:"last_behavior:>='now-7d'"},{label:"Last 30 days",selected:!1,prop:"last_behavior:>='now-30d'"},{label:"Last 90 days",selected:!1,prop:"last_behavior:>='now-90d'"}],prop:"last_behavior"},{title:"Status",fields:[{label:"New",selected:!1,prop:"new",count:0},{label:"In Progress",selected:!1,prop:"in_progress",count:0},{label:"True Positive",selected:!1,prop:"true_positive",count:0},{label:"False Positive",selected:!1,prop:"false_positive",count:0},{label:"Ignored",selected:!1,prop:"ignored",count:0}],prop:"status"},{title:"Triggering file",fields:[],prop:"behaviors.filename"},{title:"Assigned to",fields:[{label:"unassigned",selected:!1,count:0}],prop:"assigned_to"}],this.loading=!0,this.nodata=!1,this.csvData={name:"Detections.csv",data:""},this.filterChips=[],this.filterChipTemplate=[{filter:"status:'new'",chips:[{name:"Status",values:[{label:"New"}]}]},{filter:"last_seen:>'now-{{filterByLast}}'",chips:[{name:"Hosts",values:[{label:"All"}]}]}],this._css.ready.subscribe((function(){setTimeout((function(){n.updateTable()}),1e3)}))}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.router.events.subscribe((function(e){e instanceof n.b&&setTimeout((function(){window.scrollTo(0,0)}),1e3)})),setTimeout((function(){e.appService.setPath("Home/Dashboard/Detections")}),1e3),this.updateTable()}},{key:"truncateSentance",value:function(e){return e.substr(0,25)+"..."}},{key:"updateTable",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.loading=!0,this.detectionsFiltered=[],null==t&&this._css.currentDetectionFilterId>=1)switch(this._css.currentDetectionFilterId){case 2:t="status:'new'",this.filterChips=[{name:"Status",values:[{label:"New"}]}];break;case 3:this.filterChips=[{name:"Objectives",values:[{label:"All"}]}];break;case 4:this.filterChips=[{name:"Tactics",values:[{label:"All"}]}];break;case 5:this.filterChips=[{name:"Severity",values:[{label:"All"}]}]}this._css.mostRecentDetections(0,t).subscribe((function(t){0==t.length&&(e.loading=!1),e._css.mostRecentDetectionsSummries(t).subscribe((function(t){"error"!=t&&(e.detectionsFiltered=t,e.generateCSV(t),e.loading=!1,e.getFieldValues(t),e._css.currentDetectionFilterId>=1&&(e._css.currentDetectionFilterId=0,e.getFieldValues(t),window.scrollTo(0,0)))}))}))}},{key:"generateCSV",value:function(e){var t="data:text/csv;charset=utf-8,";t+="Severity,Tactic & Technique,Detect Time,Host,User name,Assigned to,Status\n",t+=e.map((function(e){var t=e.max_severity_displayname+",";return t+=e.behaviors[0].tactic+" via "+e.behaviors[0].technique+",",t+=s.a.formatDate(e.behaviors[0].timestamp,"DD MMM YYYY hh:mm a")+",",t+=e.device.hostname+",",t+=e.behaviors[0].user_name+",",t+="-,",t+=s.a.allWordUppercase(e.status)})).join("\n"),this.csvData={name:"Detections.csv",data:t}}},{key:"getFieldValues",value:function(e){var t=this;this.filterCol.map((function(e){e.fields.map((function(e){e.count=0}))})),e.map((function(e){e.behaviors.map((function(e){var i=e.severity;i=i<20?"Informal":i>=20&&i<40?"Low":i>=40&&i<60?"Medium":i>=60&&i<80?"High":"Cirtical",t.canPush(t.filterCol[0].fields,"label",i),t.canPush(t.filterCol[1].fields,"label",e.tactic),t.canPush(t.filterCol[2].fields,"label",e.technique),t.canPush(t.filterCol[5].fields,"label",e.filename)}));var i=s.a.allWordUppercase(e.status);t.canPush(t.filterCol[4].fields,"label",i)}))}},{key:"formatString",value:function(e){return s.a.allWordUppercase(e)}},{key:"canPush",value:function(e,t,i){0==e.filter((function(e){return e[t].toLowerCase()==i.toLowerCase()&&(e.count=null==e.count?1:e.count+1,!0)})).length&&e.push({label:i,selected:!1,count:1,prop:i})}}]),e}(),f.\u0275fac=function(e){return new(e||f)(l.Pb(o.a),l.Pb(c.a),l.Pb(n.c))},f.\u0275cmp=l.Jb({type:f,selectors:[["app-detections"]],decls:8,vars:7,consts:[[1,"container-fluid","full-page","p-0"],["addedFor","detections",1,".filter-sec",3,"totalDetections","filterCol","filterChips","csvData","filterSelection"],[1,"container-fluid"],["class","loader",4,"ngIf"],["class","nodata",4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],[1,"loader"],[3,"src"],[1,"nodata"],[1,"row"],[1,"priority-icon"],[1,"fab","fa-first-order","fa-2x"],[1,"priority-data"],[4,"ngIf"],[1,"col-2-title"],[1,"col-2-data",3,"title"],[1,"col-2-data"]],template:function(e,t){1&e&&(l.Ub(0,"section",0),l.Ub(1,"filter-selection",1),l.gc("filterSelection",(function(e){return t.updateTable(e)})),l.Tb(),l.Ub(2,"section",2),l.Kc(3,b,2,1,"div",3),l.Kc(4,d,2,0,"div",4),l.Ub(5,"table",5),l.Ub(6,"tbody"),l.Kc(7,p,40,11,"tr",6),l.Tb(),l.Tb(),l.Tb(),l.Tb()),2&e&&(l.Ab(1),l.rc("totalDetections",t.detectionsFiltered.length)("filterCol",t.filterCol)("filterChips",t.filterChips)("csvData",t.csvData),l.Ab(2),l.rc("ngIf",t.loading),l.Ab(1),l.rc("ngIf",t.nodata),l.Ab(3),l.rc("ngForOf",t.detectionsFiltered))},directives:[r.a,a.m,a.l],pipes:[a.d],styles:[".full-page[_ngcontent-%COMP%]{height:100vh;overflow:auto;padding-top:1em}.loader[_ngcontent-%COMP%]{text-align:center;padding-top:2em}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:5px}.table[_ngcontent-%COMP%]   .priority-icon[_ngcontent-%COMP%]{color:#ffab00;float:left}.table[_ngcontent-%COMP%]   .priority-data[_ngcontent-%COMP%]{padding-top:5px;padding-left:15px;font-size:.8em;float:left}.table[_ngcontent-%COMP%]   .col-2-title[_ngcontent-%COMP%]{text-transform:uppercase;color:#696969;font-size:.65em}.table[_ngcontent-%COMP%]   .col-2-data[_ngcontent-%COMP%]{font-size:.8em}"]}),f)}],g=((v=function e(){_classCallCheck(this,e)}).\u0275mod=l.Nb({type:v}),v.\u0275inj=l.Mb({factory:function(e){return new(e||v)},imports:[[n.e.forChild(m)],n.e]}),v),_=i("OZVm"),T=((h=function e(){_classCallCheck(this,e)}).\u0275mod=l.Nb({type:h}),h.\u0275inj=l.Mb({factory:function(e){return new(e||h)},imports:[[a.b,g,_.a]]}),h)}}]);